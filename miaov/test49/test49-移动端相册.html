<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name = "viewport" content="width=device-width,user-scalable=no,target-densitydpi=medium-dpi">
	<title>TEST49</title>
	<style>
		@-webkit-keyframes show {
			0% {
				top: calc(100% - 0.6rem);
			}

			50% {
				top: calc(100% - 0.3rem);
			}

			100% {
				top: calc(100% - 0.6rem);
			}
		}

		@-moz-keyframes show {
			0% {
				top: calc(100% - 0.6rem);
			}

			50% {
				top: calc(100% - 0.3rem);
			}

			100% {
				top: calc(100% - 0.6rem);
			}
		}

		@keyframes show {
			0% {
				top: calc(100% - 0.6rem);
			}

			50% {
				top: calc(100% - 0.3rem);
			}

			100% {
				top: calc(100% - 0.6rem);
			}
		}

		body, article, header, section, footer, div, ul, li, button {
			margin: 0;
			padding: 0;
			font-size: 0.11rem;
		}
		ul, li {
			list-style: none;
		}
		a {
			text-decoration: none;
			color: #000;
		}
		a:hover {
			text-decoration: none;
			color: #000;
		}
		button {
			border: none;
			background-color: inherit;
			outline: none;
			font-size: 0.11rem;
			color: #fff; 
			font-family: "宋体"
		}
	
		#page {
			width: 100%;
			height: 100%;
			position: absolute;
			overflow: hidden;
		}

		header {
			width: 100%;
			height: 0.4rem;
			background: linear-gradient(#292929, #1e1e1e);
			line-height: 0.4rem;
			text-align: center;
			color: #fff;
			font-family: "宋体";
			border-top: 0.019rem solid #353535;
			border-bottom: 0.019rem solid #353535;
			box-sizing: border-box;
			position: absolute;
			top: 0;
		}
		header button {
			height: 0.25rem;
			width: 0.40rem;
			border: 0.019rem solid #0d0d0d;
			border-radius: 0.028rem;
			position: absolute;
			top: 0.028rem;
		}
		header button:nth-of-type(1) {
			left: 0.094rem;
			display: none;
		}
		header button:nth-of-type(2) {
			right: 0.094rem;
		}

		section {
			width: 100%;
			position: absolute;
			top: 0.4rem;
			bottom: 0.6rem;
			overflow: auto;
			background-color: #000;
		}

		section li {
			height: 1rem;
			width: 1rem;
			background: no-repeat;
			background-size: 100% 100%;
			border: 1px solid black;
			box-sizing: border-box;
			float: left;
			transition: .5s left, .5s top;
		}

		footer {
			width: 100%;
			height: 0.6rem;
			position: absolute;
			bottom: 0;
		}
		footer button {
			width: 50%;
			height: 100%;
			background: linear-gradient(#1e1f21, #141414);
			float: left;
			box-sizing: border-box;
		}
		footer .btn1 {
			border-right: 1px solid #222222;
		}
		footer .btn2 {
			border-left: 1px solid #222222;
		}
		footer .active {
			background: linear-gradient(#101010, #080808);
			border-color: #0e0e0e;
		}

		.recycle {
			width: 1.2rem;
			height: 1.2rem;
			position: absolute;
			left: calc(50% - 0.6rem);
			top: 100%;
		}
		.recycle:nth-of-type(1) {
			background: url("images/recycle.png") no-repeat;
			background-size: contain;
			z-index: 3;
		}
		.recycle:nth-of-type(2) {
			background: url("images/recycle2.png") no-repeat;
			background-size: contain;	
			z-index: 1;	
		}
		.recycleShow {
			-webkit-animation: .4s show;
			   -moz-animation: .4s show;
			        animation: .4s show;
		}

		.PicBox {
			width: 1rem;
			height: 1rem;
			position: absolute;
			overflow: hidden;
			background-repeat: no-repeat;
			background-position: -1000px 0;
			background-size: cover;
			z-index: 2;
			-webkit-perspective: 800px;
			   -moz-perspective: 800px;
			        perspective: 800px;
		}
		.PicBox div {
			width: 0.1rem;
			height: 1rem;
			background-repeat: no-repeat;
			background-image: inherit;
			background-size: cover;
			position: absolute;
			left: 0.1rem;
			top: 0;
			-webkit-transform-style: preserve-3d;
			   -moz-transform-style: preserve-3d;
			        transform-style: preserve-3d;
			-webkit-transform-origin: left 0.6rem;
			   -moz-transform-origin: left 0.6rem;
			        transform-origin: left 0.6rem;
		}
		.PicBox > div {
			left: 0;
		}
		.PicBox div.show {
			-webkit-transform: rotateX(5deg) rotateY(-60deg);
			   -moz-transform: rotateX(5deg) rotateY(-60deg);
			        transform: rotateX(5deg) rotateY(-60deg);
		}
		.PicBox>div.show {
			-webkit-transform: rotateX(5deg) rotateY(-60deg) translateX(1rem);
			   -moz-transform: rotateX(5deg) rotateY(-60deg) translateX(1rem);
			        transform: rotateX(5deg) rotateY(-60deg) translateX(1rem);
		}
	</style>

	<script type="text/javascript">
		document.getElementsByTagName("html")[0].style.fontSize = document.documentElement.clientWidth / 3 + "px";

		var aData = [];

		for (var i = 1; i <= 16; i++) {
			oUrl = "photos/" + i + ".jpg";
			aData.push(oUrl);
		}
		
		window.onload = function() {
			var oPage = document.getElementById("page");
			var oUl = document.getElementById("list");
			var oLi = oUl.getElementsByTagName("li");
			var reBtn = document.getElementsByClassName("remove")[0];
			var seBtn = document.getElementsByClassName("select")[0];
			var aPicBox = document.getElementsByClassName("PicBox");
			var aRecycle = document.getElementsByClassName("recycle");

			var oBtn = true;
			var aRemove = [];

			function createLi(data, parent) {      // 创建图片li元素
				for (var i = 0; i < data.length; i++) {
					var oLi = document.createElement("li");

					oLi.style.backgroundImage = "url('"+ data[i] +"')";

					oUl.appendChild(oLi);
				}
			}
			createLi(aData, oUl);

			function toPosition() {         // 元素位置设置
				for (var i = 0; i < oLi.length; i++) {
					oLi[i].index = i;

					oLi[i].style.position = "absolute";

					oLi[i].style.top = Math.floor(i / 3) + "rem";

					oLi[i].style.left = i % 3 + "rem";
				}
			}
			toPosition();

			seBtn.addEventListener("touchend", fnSelect, false);
			reBtn.addEventListener("touchend", fnRemove, false);

			function fnSelect() {
				if (oBtn) {
					seBtn.innerHTML = "取消";

					reBtn.style.display = "block";

					for(var i = 0; i < oLi.length; i++) {
						oLi[i].addEventListener("touchend", liSelect, false);
					}
				} else {                // 取消删除操作

					for ( var i = 0; i < aPicBox.length; i++) {
						close3D(aPicBox[i], oLi[aRemove[i]]);
					}

					for (var i = 0; i < oLi.length; i++) {
						oLi[i].removeEventListener("touchend", liSelect, false);
					}

					aRecycle[0].style.top = "100%";
					aRecycle[1].style.top = "100%";

					aRecycle[0].className = "recycle";
					aRecycle[1].className = "recycle";

					seBtn.innerHTML = "选择";

					reBtn.style.display = "none";

					aRemove = [];          // 清空等待删除的数组
				}

				oBtn = !oBtn;
			}

			function liSelect() {

				this.style.opacity = "0";

				aRemove.push(this.index);

				aRecycle[0].style.top = "calc(100% - 0.4rem)";
				aRecycle[1].style.top = "calc(100% - 0.4rem)";

				create3D(this);
	
			}

			function fnRemove() {
				aRemove = aRemove.sort();
				
				for (var i = 0; i < aPicBox.length; i++) {
					picBoxDel(aPicBox[i]);
				}

				setTimeout(function() {

					aRecycle[0].className = "recycle recycleShow";
					aRecycle[1].className = "recycle recycleShow";
	
					while(aRemove.length) {
						
						oUl.removeChild(aPicBox[aRemove.length - 1]);

						var index = aRemove.pop();

						oUl.removeChild(oLi[index]);
					}

					setTimeout(function() {
						toPosition();

						oBtn = false;

						fnSelect();          // 将选择按钮还原初始状态
					}, 500)

				}, 650);
			
			}

			function picBoxDel(obj) {
				obj.style.transition = ".3s left, .5s .3s top";
				obj.style.left = "calc(50% - 0.5rem)";
				obj.style.top = "100%";
			}

			function create3D(obj) {
				var picBox = document.createElement("div");

				picBox.style.backgroundImage = obj.style.backgroundImage;

				picBox.className = "PicBox";

				picBox.style.top = obj.offsetTop + "px";
				picBox.style.left = obj.offsetLeft + "px";

				picBox.innerHTML = '<div><div style = "background-position: -0.1rem 0"><div style = "background-position: -0.2rem 0"><div style = "background-position: -0.3rem 0"><div style = "background-position: -0.4rem 0"><div style = "background-position: -0.5rem 0"><div style = "background-position: -0.6rem 0"><div style = "background-position: -0.7rem 0"><div style = "background-position: -0.8rem 0"><div style = "background-position: -0.9rem 0"></div></div></div></div></div></div></div></div></div></div>';

				oUl.appendChild(picBox);

				setTimeout(function() {
					open3D(picBox);
				}, 30);

			}

			function open3D(obj) {
				var oDiv = obj.getElementsByTagName("div");

				for (var i = 0; i < oDiv.length; i++) {
					oDiv[i].style.transition = "0.5s";
					oDiv[i].className = "show";
				}
			}

			function close3D(obj, oLi) {
				var oDiv = obj.getElementsByTagName("div");

				oDiv[oDiv.length - 1].addEventListener("webkitTransitionEnd", fn, false);
				oDiv[oDiv.length - 1].addEventListener("transitionend", fn, false);

				for (var i = 0; i < oDiv.length; i++) {
					oDiv[i].style.transition = "0.5s";
					oDiv[i].className = "";
				}

				function fn() {

					oDiv[oDiv.length - 1].removeEventListener("webkitTransitionEnd", fn, false);
					oDiv[oDiv.length - 1].removeEventListener("transitionend", fn, false);

					oLi.style.opacity = "1";

					oUl.removeChild(obj);

				}
			}
		};
	</script>
</head>
<body>
	<article id = "page">
		<header>
			<button class = "remove" type = "button">删除</button>
			<span class = "tit">相机相册</span>
			<button class = "select" type = "button">选择</button>
		</header>

		<section>
			<ul id = "list" class = "list">
			</ul>
		</section>
		
		<footer>
			<button class = "btn1 active">相机相册</button>
			<button class = "btn2">所有相册</button>
		</footer>


		<span class = "recycle"></span>
		<span class = "recycle"></span>

	</article>
</body>
</html>